<div class="d-flex justify-content-center">
  <table class="card-white text-center align-middle m-3 shadow-sm">
    <thead>
      <tr>
        <% if show_invitation?("sms", invitation_formats) %>
          <th class="px-4 py-3">
            <h4>Invitation SMS</h4>
          </th>
        <% end %>
        <% if show_invitation?("email", invitation_formats) %>
          <th class="px-4 py-3">
            <h4>Invitation mail</h4>
          </th>
        <% end %>
        <% if show_invitation?("postal", invitation_formats) %>
          <th class="px-4 py-3">
            <h4>Invitation courrier</h4>
          </th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% invitation_dates_by_format = invitation_dates_by_format(invitations, invitation_formats) %>
      <% invitation_dates_by_format.values.map(&:length).max.times do |idx| %>
        <tr>
          <% invitation_formats.map do |format| %>
            <td class="px-4 py-3">
              <%= format_date(invitation_dates_by_format[format]&.fetch(idx, nil)) %>
            </td>
          <% end %>
        </tr>
      <% end %>
      <tr>
        <%= render "follow_ups/invitation_column_by_format", invitation_format: "sms", invitation_formats:, user:, motif_category:, invitations:, invitation_disabled: sms_invitation_disabled_for?(user, follow_up, department) %>
        <%= render "follow_ups/invitation_column_by_format", invitation_format: "email", invitation_formats:, user:, motif_category:, invitations:, invitation_disabled: email_invitation_disabled_for?(user, follow_up, department) %>
        <%# we don't use a form for postal invitations because the logic is more complex (and there is no redirection as a response) %>
        <% if show_invitation?("postal", invitation_formats) %>
          <td class="px-4 py-3"
              data-controller="invitation-button"
              data-user-id="<%= user.id %>"
              data-department-id="<%= department.id %>"
              data-organisation-id="<%= organisation.id %>"
              data-is-department-level="<%= department_level? %>"
              data-motif-category-id="<%= motif_category.id %>"
          >
            <button
              data-action="click->invitation-button#generatePostalInvitation"
              class="btn btn-blue<%= postal_invitation_disabled_for?(user, follow_up, department) ? ' disabled' : '' %>"
              type="button"
            >
              <% if invitations.any?(&:"format_postal?") %>
                <span
                  data-controller="tooltip"
                  data-action="mouseover->tooltip#reinviteButton"
                >
                  RÃ©inviter
                </span>
              <% else %>
                Inviter
              <% end %>
            </button>
          </td>
        <% end %>
      </tr>
      <%# {showInvitationsHistoryButton && (
        <tr>
          <td class="px-4 py-2" colSpan={3} style={{ cursor: "pointer" }}>
            {!showInvitationsHistory && (
              <button onClick={handleShowInvitationsHistory} type="button">
                <i class="fas fa-angle-down" /> Voir l&apos;historique{" "}
                <i class="fas fa-angle-down" />
              </button>
            )}
            {showInvitationsHistory && (
              <button onClick={handleHideInvitationsHistory} type="button">
                <i class="fas fa-angle-up" /> Voir moins <i class="fas fa-angle-up" />
              </button>
            )}
          </td>
        </tr>
      )} %>
    </tbody>
  </table>
</div>
