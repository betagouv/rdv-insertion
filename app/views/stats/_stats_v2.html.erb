<div class="container marianne">
  <%= render 'header' %>
  <div class="row d-flex justify-content-center mt-4 flex-wrap">
    <div class="col-12 col-md-6 px-5 pb-5">
      <p class="highlight-stat big margin-left"><%= Stats::CounterCache::UsersCreated.value(scope: @organisation || @department || Department.new) %></p>
      <p class="highlight-stat margin-left">usagers gérés dans rdv-insertion</p>
      <%= line_chart Stats::CounterCache::UsersCreated.values_grouped_by_month(scope: @organisation || @department || Department.new), title: "Nouveaux usagers par mois", colors: ["#083b66"] %>
    </div>
    <div class="col-12 col-md-6 px-5 pb-5 background-blue-light">
      <p class="highlight-stat big margin-left"><%= Stats::CounterCache::RdvsTaken.value(scope: @organisation || @department || Department.new) %></p>
      <p class="highlight-stat margin-left">rendez-vous pris</p>
      <%= line_chart Stats::CounterCache::RdvsTaken.values_grouped_by_month(scope: @organisation || @department || Department.new), title: "Nouveaux rdvs par mois", colors: ["#083b66"] %>
    </div>
  </div>
  <% if current_page?(action: 'index') || @display_all_stats %>
    <div class="row d-flex justify-content-center flex-wrap-reverse">
      <div class="col-12 col-md-6 px-5 pb-5 background-blue-light">
        <p class="highlight-stat big margin-left"><%= Stats::CounterCache::InvitationsSent.value(scope: @organisation || @department || Department.new) %></p>
        <p class="highlight-stat margin-left">invitations envoyées par mail, SMS, et courrier</p>
        <%= line_chart Stats::CounterCache::InvitationsSent.values_grouped_by_month(scope: @organisation || @department || Department.new), title: "Invitations envoyées par mois", colors: ["#083b66"] %>
      </div>
      <div class="col-12 col-md-6 px-5 pb-5">
        <p class="highlight-stat big margin-left"><%= Stats::CounterCache::DaysBetweenInvitationAndRdv.value(scope: @organisation || @department || Department.new).round %> jours</p>
        <p class="highlight-stat margin-left">délai moyen entre l'invitation et la prise de rendez-vous</p>
        <%= line_chart Stats::CounterCache::DaysBetweenInvitationAndRdv.values_grouped_by_month(scope: @organisation || @department || Department.new, start_at: Time.zone.parse("2022-01-01")), title: "Délai moyen d'invitation par mois", ytitle: "jours", colors: ["#083b66"] %>
      </div>
    </div>
    <div class="row d-flex justify-content-center flex-wrap">
      <div class="col-12 col-md-6 px-5 pb-5">
        <p class="highlight-stat big margin-left"><%= Stats::CounterCache::RateOfNoShow::Invitations.value(scope: @organisation || @department || Department.new)&.round %> %</p>
        <p class="highlight-stat margin-left">de rendez-vous non honorés avec rdv-insertion <strong>après invitation</strong></p>
        <%= line_chart Stats::CounterCache::RateOfNoShow::Invitations.values_grouped_by_month(scope: @organisation || @department || Department.new), title: "Taux de rdvs non honorés après invitation par mois", suffix: "%", colors: ["#083b66"] %>
      </div>
      <div class="col-12 col-md-6 px-5 pb-5 background-blue-light">
        <p class="highlight-stat big margin-left"><%= Stats::CounterCache::RateOfNoShow::Convocations.value(scope: @organisation || @department || Department.new)&.round %> %</p>
        <p class="highlight-stat margin-left">de rendez-vous non honorés avec rdv-insertion <strong>après convocation</strong></p>
        <%= line_chart Stats::CounterCache::RateOfNoShow::Convocations.values_grouped_by_month(scope: @organisation || @department || Department.new, start_at: Time.zone.parse("2022-10-01")), title: "Taux de rdvs non honorés après convocation par mois", suffix: "%", colors: ["#083b66"] %>
      </div>
    </div>
    <div class="row d-flex justify-content-center flex-wrap-reverse">
      <div class="col-12 col-md-6 px-5 pb-5 background-blue-light">
        <p class="highlight-stat big margin-left"><%= Stats::CounterCache::RateOfAutonomousUsers.value(scope: @organisation || @department || Department.new).round %> %</p>
        <p class="highlight-stat margin-left">d'usagers invités ayant pris au moins <strong>un rendez-vous en autonomie</strong></p>
        <%= line_chart Stats::CounterCache::RateOfAutonomousUsers.values_grouped_by_month(scope: @organisation || @department || Department.new), title: "Taux d'usagers autonomes par mois", suffix: "%", colors: ["#083b66"] %>
      </div>
      <div class="col-12 col-md-6 px-5 pb-5">
        <p class="highlight-stat big margin-left"><%= Stats::CounterCache::RateOfUsersWithRdvSeenInLessThanThirtyDays.value(scope: @organisation || @department || Department.new)&.round %> %</p>
        <p class="highlight-stat margin-left">d'usagers <strong>ayant honoré un 1er rendez-vous RSA en - de 30 jours</strong></p>
        <%= line_chart Stats::CounterCache::RateOfUsersWithRdvSeenInLessThanThirtyDays.values_grouped_by_month(scope: @organisation || @department || Department.new, stop_at: 30.days.ago), title: "Taux rdv en - de 30 jours par mois", suffix: "%", colors: ["#083b66"] %>
      </div>
    </div>
    <div class="row d-flex justify-content-center flex-wrap-reverse">
      <div class="col-12 col-md-6 px-5 pb-5">
        <p class="highlight-stat big margin-left"><%= Stats::CounterCache::RateOfUsersWithRdvSeen.value(scope: @organisation || @department || Department.new)&.round %> %</p>
        <p class="highlight-stat margin-left">d'usagers ajoutés dans l'outil pour un RDV d'orientation <strong>ont eu leur orientation réalisée via rdv-insertion</strong></p>
        <%= line_chart Stats::CounterCache::RateOfUsersWithRdvSeen.values_grouped_by_month(scope: @organisation || @department || Department.new), title: "Taux d'usagers orientés via l'outil par mois", suffix: "%", colors: ["#083b66"] %>
      </div>
    </div>
    <div class="row d-flex justify-content-center flex-wrap">
      <div class="col-12 col-md-6 px-5 pb-5 d-flex flex-column justify-content-center align-items-center">
        <p class="highlight-stat big margin-left"><%= Stats::CounterCache::NumberOfAgents.value(scope: @organisation || @department || Department.new) %> agents</p>
        <% if current_page?(action: 'index') %>
          <p class="highlight-stat margin-left">travaillant pour <strong><%= @department_count %> départements</strong>  utilisent rdv-insertion</p>
        <% else %>
          <p class="highlight-stat margin-left">utilisent rdv-insertion</p>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
